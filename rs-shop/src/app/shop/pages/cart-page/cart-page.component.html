<div class="card">
  <div class="product-name mb-3">Оформление заказа</div>
  <div class="flex xl:flex-nowrap flex-wrap">
    <div class="flex flex-column">
      <p-dataView #dv [value]="cartItems" [rows]="5" layout="list" [emptyMessage]="cartMessage">
        <ng-template let-product pTemplate="listItem">
          <div class="col-12">
            <div class="product-list-item">
              <img [src]="product.imageUrls[0]" [alt]="product.name" />
              <div class="product-list-detail">
                <div class="product-name">
                  <a [routerLink]="['/main', 'item', product.id]">
                    {{ product.name }}
                  </a>
                </div>
                <div class="product-description">{{ product.description }}</div>
                <div class="flex align-items-center">
                  <p-button
                    icon="pi pi-trash"
                    label="Удалить"
                    (click)="onDeleteFromCart(product.id)"
                    class="mx-3"
                  ></p-button>
                </div>
              </div>
              <div class="product-list-action flex flex-wrap">
                <span class="product-price"
                  >{{ product.price * product.amountToOrder | number: '0.2' }} p.</span
                >
                <div class="flex">
                  <label for="horizontal" class="product-price pr-3">Кол-во:</label>
                  <p-inputNumber
                    [(ngModel)]="product.amountToOrder"
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    spinnerMode="horizontal"
                    inputId="horizontal"
                    decrementButtonClass="p-button-primary"
                    incrementButtonClass="p-button-primary"
                    incrementButtonIcon="pi pi-plus"
                    decrementButtonIcon="pi pi-minus"
                    [min]="1"
                    [max]="product.availableAmount"
                    [size]="1"
                    (onInput)="priceInput(cartItems)"
                  >
                  </p-inputNumber>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </p-dataView>

      <span *ngIf="cartItems.length !== 0" class="product-price pt-2"
        >Oбщая стоимость: {{ totalPrice | number: '0.2' }} p.</span
      >
    </div>

    <div *ngIf="cartItems.length !== 0" class="w-full mt-3 xl:mt-0 xl:ml-3">
      <form
        [formGroup]="orderForm"
        (ngSubmit)="onSubmitOrder()"
        class="border-gray-100 border-2 border-solid p-4 border-round"
      >
        <div class="pb-3">
          <div class="mb-3">
            <label for="name" class="block text-900 font-medium mb-2">ФИО</label>
            <input
              pInputText
              aria-describedby="name-help"
              id="name"
              type="text"
              formControlName="name"
              class="w-full"
              maxlength="50"
            />
            <div *ngIf="name!.invalid && (name!.dirty || name!.touched)">
              <small class="text-pink-600" id="name-help" *ngIf="name!.errors?.required">
                *Обязательно для заполнения.
              </small>
              <small class="text-pink-600" id="name-help" *ngIf="name!.errors?.minlength">
                *Минимум 3 символа.
              </small>
            </div>
          </div>

          <div class="mb-3">
            <label for="address" class="block text-900 font-medium mb-2">Адрес доставки</label>
            <input
              pInputText
              aria-describedby="address-help"
              id="address"
              type="text"
              formControlName="address"
              class="w-full"
              maxlength="250"
            />
            <div *ngIf="address!.invalid && (address!.dirty || address!.touched)">
              <small class="text-pink-600" id="address-help" *ngIf="address!.errors?.required">
                *Обязательно для заполнения.
              </small>
              <small class="text-pink-600" id="address-help" *ngIf="address!.errors?.minlength">
                *Минимум 3 символа.
              </small>
            </div>
          </div>

          <div class="mb-3">
            <label for="phone" class="block text-900 font-medium mb-2">Номер телефона</label>
            <input
              id="phone"
              type="phone"
              formControlName="phone"
              pInputText
              class="w-full"
              aria-describedby="phone-help"
              placeholder="+375()"
            />
            <div *ngIf="phone!.invalid && (phone!.dirty || phone!.touched)">
              <small class="text-pink-600" id="phone-help" *ngIf="phone!.errors?.required">
                *Обязательно для заполнения.
              </small>
              <small class="text-pink-600" id="phone-help" *ngIf="phone!.errors?.minlength">
                *Минимум 2 символа.
              </small>
              <small class="text-pink-600" id="phone-help" *ngIf="phone!.errors?.pattern">
                *Должен быть введён корректный номер телефона.
              </small>
            </div>
          </div>

          <div class="mb-5">
            <label for="timeToDeliver" class="block text-900 font-medium mb-2"
              >Желаемое время доставки</label
            >
            <input
              formControlName="timeToDeliver"
              pInputText
              id="timeToDeliver"
              type="datetime-local"
              aria-describedby="timeToDeliver-help"
            />
            <div *ngIf="timeToDeliver!.invalid && (timeToDeliver!.dirty || timeToDeliver!.touched)">
              <small
                class="text-pink-600"
                id="timeToDeliver-help"
                *ngIf="timeToDeliver!.errors?.required"
              >
                *Обязательно для заполнения.
              </small>
            </div>
          </div>
          <div class="mb-3">
            <span class="p-float-label">
              <textarea
                class="w-full"
                id="comment"
                rows="5"
                pInputTextarea
                [autoResize]="true"
                formControlName="comment"
                maxlength="250"
              ></textarea>
              <label for="comment">Комментарий к заказу</label>
            </span>
          </div>
        </div>
        <button
          type="submit"
          [disabled]="!orderForm.valid"
          pButton
          pRipple
          label="Сделать заказ"
          icon="pi pi-shopping-cart"
        ></button>
      </form>
    </div>
  </div>
</div>
